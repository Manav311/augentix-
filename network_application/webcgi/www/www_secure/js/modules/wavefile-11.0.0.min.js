const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function e(t,e,r,u){if(["32f","64"].indexOf(e)>-1&&["32f","64"].indexOf(u)>-1)return void r.set(t);n(e),n(u);let l=function(t,e){let n=function(t){return t};t!=e&&(n=["32f","64"].includes(t)?i:["32f","64"].includes(e)?h:s);return n}(e,u),o={oldMin:Math.pow(2,parseInt(e,10))/2,newMin:Math.pow(2,parseInt(u,10))/2,oldMax:Math.pow(2,parseInt(e,10))/2-1,newMax:Math.pow(2,parseInt(u,10))/2-1};a(e,t,!0);for(let e=0,s=t.length;e<s;e++)r[e]=l(t[e],o);a(u,r,!1)}function s(t,e){return t=t>0?parseInt(t/e.oldMax*e.newMax,10):parseInt(t/e.oldMin*e.newMin,10)}function i(t,e){return parseInt(t>0?t*e.newMax:t*e.newMin,10)}function h(t,e){return t>0?t/e.oldMax:t/e.oldMin}function n(t){if("32f"!=t&&"64"!=t&&(parseInt(t,10)<"8"||parseInt(t,10)>"53"))throw new Error("Invalid bit depth.")}function a(t,e,s){if("8"==t){let t=s?-128:128;for(let s=0,i=e.length;s<i;s++)e[s]=e[s]+=t}}const r=[-1,-1,-1,-1,2,4,6,8,-1,-1,-1,-1,2,4,6,8],u=[7,8,9,10,11,12,13,14,16,17,19,21,23,25,28,31,34,37,41,45,50,55,60,66,73,80,88,97,107,118,130,143,157,173,190,209,230,253,279,307,337,371,408,449,494,544,598,658,724,796,876,963,1060,1166,1282,1411,1552,1707,1878,2066,2272,2499,2749,3024,3327,3660,4026,4428,4871,5358,5894,6484,7132,7845,8630,9493,10442,11487,12635,13899,15289,16818,18500,20350,22385,24623,27086,29794,32767];function l(t,e){let s=function(t,e){d(t,e);let s=[];return s.push(255&t),s.push(t>>8&255),s.push(e.index),s.push(0),s}(t[0],e);for(let i=3,h=t.length;i<h;i+=2){let h=d(t[i],e),n=d(t[i+1],e);s.push(n<<4|h)}return s}function o(t,e){var s;e.predicted=(s=t[1]<<8|t[0])>32768?s-65536:s,e.index=t[2],e.step=u[e.index];let i=[e.predicted,e.predicted];for(let s=4,h=t.length;s<h;s++){let h=t[s],n=h>>4,a=n<<4^h;i.push(c(a,e)),i.push(c(n,e))}return i}function d(t,e){let s=t-e.predicted,i=0;s>=0?i=0:(i=8,s=-s);let h=u[e.index],n=h>>3;return s>h&&(i|=4,s-=h,n+=h),h>>=1,s>h&&(i|=2,s-=h,n+=h),h>>=1,s>h&&(i|=1,n+=h),function(t,e,s){8&t?s.predicted-=e:s.predicted+=e;s.predicted<-32768?s.predicted=-32768:s.predicted>32767&&(s.predicted=32767);s.index+=r[7&t],s.index<0?s.index=0:s.index>88&&(s.index=88)}(i,n,e),i}function c(t,e){let s=0;return 4&t&&(s+=e.step),2&t&&(s+=e.step>>1),1&t&&(s+=e.step>>2),s+=e.step>>3,8&t&&(s=-s),e.predicted+=s,e.predicted>32767?e.predicted=32767:e.predicted<-32767&&(e.predicted=-32767),function(t,e){e.index+=r[t],e.index<0?e.index=0:e.index>88&&(e.index=88);e.step=u[e.index]}(t,e),e.predicted}const f=[1,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7];function p(t){let e,s=~(t=-32768==t?-32767:t)>>8&128;if(s||(t*=-1),t>32635&&(t=32635),t>=256){let s=f[t>>8&127];e=s<<4|t>>s+3&15}else e=t>>4;return 85^e^s}function m(t){let e=0;0!=(128&(t^=85))&&(t&=-129,e=-1);let s=4+((240&t)>>4),i=0;return i=4!=s?1<<s|(15&t)<<s-4|1<<s-5:t<<1|1,i=0===e?i:-i,8*i*-1}const I=[0,0,1,1,2,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7],g=[0,132,396,924,1980,4092,8316,16764];function k(t){let e,s,i,h;return e=t>>8&128,0!=e&&(t=-t),(t+=132)>32635&&(t=32635),s=I[t>>7&255],i=t>>s+3&15,h=~(e|s<<4|i),h}function S(t){let e,s,i,h;return e=128&(t=~t),s=t>>4&7,i=15&t,h=g[s]+(i<<s+3),0!=e&&(h=-h),h}function b(t,e,s=0,i=t.length){for(let h=s;h<i;h+=e)_(t,e,h)}function _(t,e,s){e--;for(let i=0;i<e;i++){let h=t[s+i];t[s+i]=t[s+e],t[s+e]=h,e--}}function w(t,e,s=0){let i=0,h=t.length;for(;i<h;){let h=t.codePointAt(i);if(h<128)e[s]=h,s++;else{let t=0,n=0;for(h<=2047?(t=1,n=192):h<=65535?(t=2,n=224):h<=1114111&&(t=3,n=240,i++),e[s]=(h>>6*t)+n,s++;t>0;)e[s]=128|h>>6*(t-1)&63,s++,t--}i++}return s}class C{constructor(t,e=!1){this.bits=t,this.offset=Math.ceil(t/8),this.max=Math.pow(2,t)-1,this.min=0,this.unpack=this.unpack_,e&&(this.max=Math.pow(2,t)/2-1,this.min=-this.max-1,this.unpack=this.unpackSigned_)}pack(t,e,s=0){e=this.clamp_(Math.round(e));for(let i=0,h=this.offset;i<h;i++)t[s]=255&Math.floor(e/Math.pow(2,8*i)),s++;return s}unpack_(t,e=0){let s=0;for(let i=0;i<this.offset;i++)s+=t[e+i]*Math.pow(256,i);return s}unpackSigned_(t,e=0){return this.sign_(this.unpack_(t,e))}clamp_(t){return t>this.max?this.max:t<this.min?this.min:t}sign_(t){return t>this.max&&(t-=2*this.max+2),t}}class L{constructor(t,e){this.offset=Math.ceil((t+e)/8),this.ebits=t,this.fbits=e,this.bias=(1<<t-1)-1,this.biasP2=Math.pow(2,this.bias+1),this.ebitsFbits=t+e,this.fbias=Math.pow(2,-(8*this.offset-1-t))}pack(t,e,s){Math.abs(e)>this.biasP2-2*this.ebitsFbits&&(e=e<0?-1/0:1/0);let i=((e=+e)||1/e)<0||e<0?1:0;e=Math.abs(e);let h=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),n=T(e/Math.pow(2,h)*Math.pow(2,this.fbits));return e!=e?(n=Math.pow(2,this.fbits-1),h=(1<<this.ebits)-1):0!==e&&(e>=Math.pow(2,1-this.bias)?(n/Math.pow(2,this.fbits)>=2&&(h+=1,n=1),h>this.bias?(h=(1<<this.ebits)-1,n=0):(h+=this.bias,n=T(n)-Math.pow(2,this.fbits))):(n=T(e/Math.pow(2,1-this.bias-this.fbits)),h=0)),this.packFloatBits_(t,s,i,h,n)}unpack(t,e){let s,i=(1<<this.ebits)-1,h="";for(let s=this.offset-1;s>=0;s--){let i=t[s+e].toString(2);h+="00000000".substring(i.length)+i}let n="1"==h.charAt(0)?-1:1;h=h.substring(1);let a=parseInt(h.substring(0,this.ebits),2);return h=h.substring(this.ebits),a==i?0!==parseInt(h,2)?NaN:n*(1/0):(0===a?(a+=1,s=parseInt(h,2)):s=parseInt("1"+h,2),n*s*this.fbias*Math.pow(2,a-this.bias))}packFloatBits_(t,e,s,i,h){let n=[];n.push(s);for(let t=this.ebits;t>0;t-=1)n[t]=i%2?1:0,i=Math.floor(i/2);let a=n.length;for(let t=this.fbits;t>0;t-=1)n[a+t]=h%2?1:0,h=Math.floor(h/2);let r=n.join(""),u=this.offset+e-1,l=e;for(;u>=e;)t[u]=parseInt(r.substring(0,8),2),r=r.substring(8),u--,l++;return l}}function T(t){let e=Math.floor(t),s=t-e;return s<.5?e:s>.5||e%2?e+1:e}function M(t,e=0,s=t.length){return function(t,e=0,s=t.length){let i="";for(let h=e;h<s;){let e=128,s=191,n=!1,a=t[h++];if(a>=0&&a<=127)i+=String.fromCharCode(a);else{let r=0;a>=194&&a<=223?r=1:a>=224&&a<=239?(r=2,224===t[h]&&(e=160),237===t[h]&&(s=159)):a>=240&&a<=244?(r=3,240===t[h]&&(e=144),244===t[h]&&(s=143)):n=!0,a&=(1<<8-r-1)-1;for(let i=0;i<r;i++)(t[h]<e||t[h]>s)&&(n=!0),a=a<<6|63&t[h],h++;n?i+=String.fromCharCode(65533):a<=65535?i+=String.fromCharCode(a):(a-=65536,i+=String.fromCharCode(55296+(a>>10&1023),56320+(1023&a)))}}return i}(t,e,s)}function x(t){let e=[];return w(t,e),e}function P(t,e,s=0){return w(t,e,s)}function y(t,e,s,i=0){let h=v((e=e||{}).bits,e.fp,e.signed),n=Math.ceil(e.bits/8),a=0,r=i;for(let e=t.length;a<e;a++)i=h.pack(s,t[a],i);return e.be&&b(s,n,r,i),i}function z(t,e,s,i=0,h=t.length){let n=v((e=e||{}).bits,e.fp,e.signed);if(h=function(t,e,s,i){return s-(s-e)%i}(0,i,h,n.offset),e.be){let a=function(t){return new Uint8Array(t)}(t);e.be&&b(a,n.offset,i,h),U(a,s,i,h,n)}else U(t,s,i,h,n)}function F(t,e,s,i=0){return y([t],e,s,i)}function D(t,e){let s=[];return F(t,e,s,0),s}function B(t,e,s=0){let i=[];return z(t,e,i,s,s+Math.ceil(e.bits/8)),i[0]}function U(t,e,s,i,h){let n=h.offset;for(let a=0,r=s;r<i;r+=n,a++)e[a]=h.unpack(t,r)}function v(t,e,s){return e&&32==t?new L(8,23):e&&64==t?new L(11,52):new C(t,s)}class A extends class{constructor(){this.container="",this.chunkSize=0,this.format="",this.signature=null,this.head=0,this.uInt32={bits:32,be:!1},this.supported_containers=["RIFF","RIFX"]}setSignature(t){if(this.head=0,this.container=this.readString(t,4),-1===this.supported_containers.indexOf(this.container))throw Error("Not a supported format.");this.uInt32.be="RIFX"===this.container,this.chunkSize=this.readUInt32(t),this.format=this.readString(t,4),this.signature={chunkId:this.container,chunkSize:this.chunkSize,format:this.format,subChunks:this.getSubChunksIndex_(t)}}findChunk(t,e=!1){let s=this.signature.subChunks,i=[];for(let h=0;h<s.length;h++)if(s[h].chunkId==t){if(!e)return s[h];i.push(s[h])}return"LIST"==t&&i.length?i:null}readString(t,e){let s="";return s=M(t,this.head,this.head+e),this.head+=e,s}readUInt32(t){let e=B(t,this.uInt32,this.head);return this.head+=4,e}getSubChunksIndex_(t){let e=[],s=this.head;for(;s<=t.length-8;)e.push(this.getSubChunkIndex_(t,s)),s+=8+e[e.length-1].chunkSize,s=s%2?s+1:s;return e}getSubChunkIndex_(t,e){let s={chunkId:this.getChunkId_(t,e),chunkSize:this.getChunkSize_(t,e)};if("LIST"==s.chunkId)s.format=M(t,e+8,e+12),this.head+=4,s.subChunks=this.getSubChunksIndex_(t);else{let t=s.chunkSize%2?s.chunkSize+1:s.chunkSize;this.head=e+8+t,s.chunkData={start:e+8,end:this.head}}return s}getChunkId_(t,e){return this.head+=4,M(t,e,e+4)}getChunkSize_(t,e){return this.head+=4,B(t,this.uInt32,e+4)}}{constructor(){super(),this.supported_containers.push("RF64"),this.fmt={chunkId:"",chunkSize:0,audioFormat:0,numChannels:0,sampleRate:0,byteRate:0,blockAlign:0,bitsPerSample:0,cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]},this.fact={chunkId:"",chunkSize:0,dwSampleLength:0},this.cue={chunkId:"",chunkSize:0,dwCuePoints:0,points:[]},this.smpl={chunkId:"",chunkSize:0,dwManufacturer:0,dwProduct:0,dwSamplePeriod:0,dwMIDIUnityNote:0,dwMIDIPitchFraction:0,dwSMPTEFormat:0,dwSMPTEOffset:0,dwNumSampleLoops:0,dwSamplerData:0,loops:[]},this.bext={chunkId:"",chunkSize:0,description:"",originator:"",originatorReference:"",originationDate:"",originationTime:"",timeReference:[0,0],version:0,UMID:"",loudnessValue:0,loudnessRange:0,maxTruePeakLevel:0,maxMomentaryLoudness:0,maxShortTermLoudness:0,reserved:"",codingHistory:""},this.iXML={chunkId:"",chunkSize:0,value:""},this.ds64={chunkId:"",chunkSize:0,riffSizeHigh:0,riffSizeLow:0,dataSizeHigh:0,dataSizeLow:0,originationTime:0,sampleCountHigh:0,sampleCountLow:0},this.data={chunkId:"",chunkSize:0,samples:new Uint8Array(0)},this.LIST=[],this.junk={chunkId:"",chunkSize:0,chunkData:[]},this._PMX={chunkId:"",chunkSize:0,value:""},this.uInt16={bits:16,be:!1,signed:!1,fp:!1}}fromBuffer(t,e=!0){if(this.clearHeaders(),this.setSignature(t),this.uInt16.be=this.uInt32.be,"WAVE"!=this.format)throw Error('Could not find the "WAVE" format identifier');this.readDs64Chunk_(t),this.readFmtChunk_(t),this.readFactChunk_(t),this.readBextChunk_(t),this.readiXMLChunk_(t),this.readCueChunk_(t),this.readSmplChunk_(t),this.readDataChunk_(t,e),this.readJunkChunk_(t),this.readLISTChunk_(t),this.read_PMXChunk_(t)}clearHeaders(){let t=new A;Object.assign(this.fmt,t.fmt),Object.assign(this.fact,t.fact),Object.assign(this.cue,t.cue),Object.assign(this.smpl,t.smpl),Object.assign(this.bext,t.bext),Object.assign(this.iXML,t.iXML),Object.assign(this.ds64,t.ds64),Object.assign(this.data,t.data),this.LIST=[],Object.assign(this.junk,t.junk),Object.assign(this._PMX,t._PMX)}readFmtChunk_(t){let e=this.findChunk("fmt ");if(!e)throw Error('Could not find the "fmt " chunk');this.head=e.chunkData.start,this.fmt.chunkId=e.chunkId,this.fmt.chunkSize=e.chunkSize,this.fmt.audioFormat=this.readUInt16_(t),this.fmt.numChannels=this.readUInt16_(t),this.fmt.sampleRate=this.readUInt32(t),this.fmt.byteRate=this.readUInt32(t),this.fmt.blockAlign=this.readUInt16_(t),this.fmt.bitsPerSample=this.readUInt16_(t),this.readFmtExtension_(t)}readFmtExtension_(t){this.fmt.chunkSize>16&&(this.fmt.cbSize=this.readUInt16_(t),this.fmt.chunkSize>18&&(this.fmt.validBitsPerSample=this.readUInt16_(t),this.fmt.chunkSize>20&&(this.fmt.dwChannelMask=this.readUInt32(t),this.fmt.subformat=[this.readUInt32(t),this.readUInt32(t),this.readUInt32(t),this.readUInt32(t)])))}readFactChunk_(t){let e=this.findChunk("fact");e&&(this.head=e.chunkData.start,this.fact.chunkId=e.chunkId,this.fact.chunkSize=e.chunkSize,this.fact.dwSampleLength=this.readUInt32(t))}readCueChunk_(t){let e=this.findChunk("cue ");if(e){this.head=e.chunkData.start,this.cue.chunkId=e.chunkId,this.cue.chunkSize=e.chunkSize,this.cue.dwCuePoints=this.readUInt32(t);for(let e=0;e<this.cue.dwCuePoints;e++)this.cue.points.push({dwName:this.readUInt32(t),dwPosition:this.readUInt32(t),fccChunk:this.readString(t,4),dwChunkStart:this.readUInt32(t),dwBlockStart:this.readUInt32(t),dwSampleOffset:this.readUInt32(t)})}}readSmplChunk_(t){let e=this.findChunk("smpl");if(e){this.head=e.chunkData.start,this.smpl.chunkId=e.chunkId,this.smpl.chunkSize=e.chunkSize,this.smpl.dwManufacturer=this.readUInt32(t),this.smpl.dwProduct=this.readUInt32(t),this.smpl.dwSamplePeriod=this.readUInt32(t),this.smpl.dwMIDIUnityNote=this.readUInt32(t),this.smpl.dwMIDIPitchFraction=this.readUInt32(t),this.smpl.dwSMPTEFormat=this.readUInt32(t),this.smpl.dwSMPTEOffset=this.readUInt32(t),this.smpl.dwNumSampleLoops=this.readUInt32(t),this.smpl.dwSamplerData=this.readUInt32(t);for(let e=0;e<this.smpl.dwNumSampleLoops;e++)this.smpl.loops.push({dwName:this.readUInt32(t),dwType:this.readUInt32(t),dwStart:this.readUInt32(t),dwEnd:this.readUInt32(t),dwFraction:this.readUInt32(t),dwPlayCount:this.readUInt32(t)})}}readDataChunk_(t,e){let s=this.findChunk("data");if(!s)throw Error('Could not find the "data" chunk');this.data.chunkId="data",this.data.chunkSize=s.chunkSize,e&&(this.data.samples=t.slice(s.chunkData.start,s.chunkData.end))}readBextChunk_(t){let e=this.findChunk("bext");e&&(this.head=e.chunkData.start,this.bext.chunkId=e.chunkId,this.bext.chunkSize=e.chunkSize,this.bext.description=this.readString(t,256),this.bext.originator=this.readString(t,32),this.bext.originatorReference=this.readString(t,32),this.bext.originationDate=this.readString(t,10),this.bext.originationTime=this.readString(t,8),this.bext.timeReference=[this.readUInt32(t),this.readUInt32(t)],this.bext.version=this.readUInt16_(t),this.bext.UMID=this.readString(t,64),this.bext.loudnessValue=this.readUInt16_(t),this.bext.loudnessRange=this.readUInt16_(t),this.bext.maxTruePeakLevel=this.readUInt16_(t),this.bext.maxMomentaryLoudness=this.readUInt16_(t),this.bext.maxShortTermLoudness=this.readUInt16_(t),this.bext.reserved=this.readString(t,180),this.bext.codingHistory=this.readString(t,this.bext.chunkSize-602))}readiXMLChunk_(t){let e=this.findChunk("iXML");e&&(this.head=e.chunkData.start,this.iXML.chunkId=e.chunkId,this.iXML.chunkSize=e.chunkSize,this.iXML.value=M(t,this.head,this.head+this.iXML.chunkSize))}readDs64Chunk_(t){let e=this.findChunk("ds64");if(e)this.head=e.chunkData.start,this.ds64.chunkId=e.chunkId,this.ds64.chunkSize=e.chunkSize,this.ds64.riffSizeHigh=this.readUInt32(t),this.ds64.riffSizeLow=this.readUInt32(t),this.ds64.dataSizeHigh=this.readUInt32(t),this.ds64.dataSizeLow=this.readUInt32(t),this.ds64.originationTime=this.readUInt32(t),this.ds64.sampleCountHigh=this.readUInt32(t),this.ds64.sampleCountLow=this.readUInt32(t);else if("RF64"==this.container)throw Error('Could not find the "ds64" chunk')}readLISTChunk_(t){let e=this.findChunk("LIST",!0);if(null!==e)for(let s=0;s<e.length;s++){let i=e[s];this.LIST.push({chunkId:i.chunkId,chunkSize:i.chunkSize,format:i.format,subChunks:[]});for(let e=0;e<i.subChunks.length;e++)this.readLISTSubChunks_(i.subChunks[e],i.format,t)}}readLISTSubChunks_(t,e,s){"adtl"==e?["labl","note","ltxt"].indexOf(t.chunkId)>-1&&this.readLISTadtlSubChunks_(s,t):"INFO"==e&&this.readLISTINFOSubChunks_(s,t)}readLISTadtlSubChunks_(t,e){this.head=e.chunkData.start;let s={chunkId:e.chunkId,chunkSize:e.chunkSize,dwName:this.readUInt32(t)};"ltxt"==e.chunkId?(s.dwSampleLength=this.readUInt32(t),s.dwPurposeID=this.readUInt32(t),s.dwCountry=this.readUInt16_(t),s.dwLanguage=this.readUInt16_(t),s.dwDialect=this.readUInt16_(t),s.dwCodePage=this.readUInt16_(t),s.value=""):s.value=this.readZSTR_(t,this.head),this.LIST[this.LIST.length-1].subChunks.push(s)}readLISTINFOSubChunks_(t,e){this.head=e.chunkData.start,this.LIST[this.LIST.length-1].subChunks.push({chunkId:e.chunkId,chunkSize:e.chunkSize,value:this.readZSTR_(t,this.head)})}readJunkChunk_(t){let e=this.findChunk("junk");e&&(this.junk={chunkId:e.chunkId,chunkSize:e.chunkSize,chunkData:[].slice.call(t.slice(e.chunkData.start,e.chunkData.end))})}read_PMXChunk_(t){let e=this.findChunk("_PMX");e&&(this.head=e.chunkData.start,this._PMX.chunkId=e.chunkId,this._PMX.chunkSize=e.chunkSize,this._PMX.value=M(t,this.head,this.head+this._PMX.chunkSize))}readZSTR_(t,e=0){for(let s=e;s<t.length&&(this.head++,0!==t[s]);s++);return M(t,e,this.head-1)}readUInt16_(t){let e=B(t,this.uInt16,this.head);return this.head+=2,e}}function R(t,e){let s=x(t);for(let t=s.length;t<e;t++)s.push(0);return s}class O extends A{toBuffer(){this.uInt16.be="RIFX"===this.container,this.uInt32.be=this.uInt16.be;let t=[this.getJunkBytes_(),this.getDs64Bytes_(),this.getBextBytes_(),this.getiXMLBytes_(),this.getFmtBytes_(),this.getFactBytes_(),x(this.data.chunkId),D(this.data.samples.length,this.uInt32),this.data.samples,this.getCueBytes_(),this.getSmplBytes_(),this.getLISTBytes_(),this.get_PMXBytes_()],e=0;for(let s=0;s<t.length;s++)e+=t[s].length;let s=new Uint8Array(e+12),i=0;i=P(this.container,s,i),i=F(e+4,this.uInt32,s,i),i=P(this.format,s,i);for(let e=0;e<t.length;e++)s.set(t[e],i),i+=t[e].length;return s}getBextBytes_(){let t=[];return this.enforceBext_(),this.bext.chunkId&&(this.bext.chunkSize=602+this.bext.codingHistory.length,t=t.concat(x(this.bext.chunkId),D(602+this.bext.codingHistory.length,this.uInt32),R(this.bext.description,256),R(this.bext.originator,32),R(this.bext.originatorReference,32),R(this.bext.originationDate,10),R(this.bext.originationTime,8),D(this.bext.timeReference[0],this.uInt32),D(this.bext.timeReference[1],this.uInt32),D(this.bext.version,this.uInt16),R(this.bext.UMID,64),D(this.bext.loudnessValue,this.uInt16),D(this.bext.loudnessRange,this.uInt16),D(this.bext.maxTruePeakLevel,this.uInt16),D(this.bext.maxMomentaryLoudness,this.uInt16),D(this.bext.maxShortTermLoudness,this.uInt16),R(this.bext.reserved,180),R(this.bext.codingHistory,this.bext.codingHistory.length))),this.enforceByteLen_(t),t}enforceBext_(){for(let t in this.bext)if(this.bext.hasOwnProperty(t)&&this.bext[t]&&"timeReference"!=t){this.bext.chunkId="bext";break}(this.bext.timeReference[0]||this.bext.timeReference[1])&&(this.bext.chunkId="bext")}getiXMLBytes_(){let t=[];if(this.iXML.chunkId){let e=x(this.iXML.value);this.iXML.chunkSize=e.length,t=t.concat(x(this.iXML.chunkId),D(this.iXML.chunkSize,this.uInt32),e)}return this.enforceByteLen_(t),t}getDs64Bytes_(){let t=[];return this.ds64.chunkId&&(t=t.concat(x(this.ds64.chunkId),D(this.ds64.chunkSize,this.uInt32),D(this.ds64.riffSizeHigh,this.uInt32),D(this.ds64.riffSizeLow,this.uInt32),D(this.ds64.dataSizeHigh,this.uInt32),D(this.ds64.dataSizeLow,this.uInt32),D(this.ds64.originationTime,this.uInt32),D(this.ds64.sampleCountHigh,this.uInt32),D(this.ds64.sampleCountLow,this.uInt32))),this.enforceByteLen_(t),t}getCueBytes_(){let t=[];if(this.cue.chunkId){let e=this.getCuePointsBytes_();t=t.concat(x(this.cue.chunkId),D(e.length+4,this.uInt32),D(this.cue.dwCuePoints,this.uInt32),e)}return this.enforceByteLen_(t),t}getCuePointsBytes_(){let t=[];for(let e=0;e<this.cue.dwCuePoints;e++)t=t.concat(D(this.cue.points[e].dwName,this.uInt32),D(this.cue.points[e].dwPosition,this.uInt32),x(this.cue.points[e].fccChunk),D(this.cue.points[e].dwChunkStart,this.uInt32),D(this.cue.points[e].dwBlockStart,this.uInt32),D(this.cue.points[e].dwSampleOffset,this.uInt32));return t}getSmplBytes_(){let t=[];if(this.smpl.chunkId){let e=this.getSmplLoopsBytes_();t=t.concat(x(this.smpl.chunkId),D(e.length+36,this.uInt32),D(this.smpl.dwManufacturer,this.uInt32),D(this.smpl.dwProduct,this.uInt32),D(this.smpl.dwSamplePeriod,this.uInt32),D(this.smpl.dwMIDIUnityNote,this.uInt32),D(this.smpl.dwMIDIPitchFraction,this.uInt32),D(this.smpl.dwSMPTEFormat,this.uInt32),D(this.smpl.dwSMPTEOffset,this.uInt32),D(this.smpl.dwNumSampleLoops,this.uInt32),D(this.smpl.dwSamplerData,this.uInt32),e)}return this.enforceByteLen_(t),t}getSmplLoopsBytes_(){let t=[];for(let e=0;e<this.smpl.dwNumSampleLoops;e++)t=t.concat(D(this.smpl.loops[e].dwName,this.uInt32),D(this.smpl.loops[e].dwType,this.uInt32),D(this.smpl.loops[e].dwStart,this.uInt32),D(this.smpl.loops[e].dwEnd,this.uInt32),D(this.smpl.loops[e].dwFraction,this.uInt32),D(this.smpl.loops[e].dwPlayCount,this.uInt32));return t}getFactBytes_(){let t=[];return this.fact.chunkId&&(t=t.concat(x(this.fact.chunkId),D(this.fact.chunkSize,this.uInt32),D(this.fact.dwSampleLength,this.uInt32))),this.enforceByteLen_(t),t}getFmtBytes_(){let t=[];if(this.fmt.chunkId){let e=t.concat(x(this.fmt.chunkId),D(this.fmt.chunkSize,this.uInt32),D(this.fmt.audioFormat,this.uInt16),D(this.fmt.numChannels,this.uInt16),D(this.fmt.sampleRate,this.uInt32),D(this.fmt.byteRate,this.uInt32),D(this.fmt.blockAlign,this.uInt16),D(this.fmt.bitsPerSample,this.uInt16),this.getFmtExtensionBytes_());return this.enforceByteLen_(e),e}throw Error('Could not find the "fmt " chunk')}getFmtExtensionBytes_(){let t=[];return this.fmt.chunkSize>16&&(t=t.concat(D(this.fmt.cbSize,this.uInt16))),this.fmt.chunkSize>18&&(t=t.concat(D(this.fmt.validBitsPerSample,this.uInt16))),this.fmt.chunkSize>20&&(t=t.concat(D(this.fmt.dwChannelMask,this.uInt32))),this.fmt.chunkSize>24&&(t=t.concat(D(this.fmt.subformat[0],this.uInt32),D(this.fmt.subformat[1],this.uInt32),D(this.fmt.subformat[2],this.uInt32),D(this.fmt.subformat[3],this.uInt32))),t}getLISTBytes_(){let t=[];for(let e=0;e<this.LIST.length;e++){let s=this.getLISTSubChunksBytes_(this.LIST[e].subChunks,this.LIST[e].format);t=t.concat(x(this.LIST[e].chunkId),D(s.length+4,this.uInt32),x(this.LIST[e].format),s)}return this.enforceByteLen_(t),t}getLISTSubChunksBytes_(t,e){let s=[];for(let i=0,h=t.length;i<h;i++)"INFO"==e?s=s.concat(this.getLISTINFOSubChunksBytes_(t[i])):"adtl"==e&&(s=s.concat(this.getLISTadtlSubChunksBytes_(t[i]))),this.enforceByteLen_(s);return s}getLISTINFOSubChunksBytes_(t){let e=[],s=R(t.value,t.value.length);return e=e.concat(x(t.chunkId),D(s.length+1,this.uInt32),s),e.push(0),e}getLISTadtlSubChunksBytes_(t){let e=[];if(["labl","note"].indexOf(t.chunkId)>-1){let s=R(t.value,t.value.length);e=e.concat(x(t.chunkId),D(s.length+4+1,this.uInt32),D(t.dwName,this.uInt32),s),e.push(0)}else"ltxt"==t.chunkId&&(e=e.concat(this.getLtxtChunkBytes_(t)));return e}getLtxtChunkBytes_(t){return[].concat(x(t.chunkId),D(t.value.length+20,this.uInt32),D(t.dwName,this.uInt32),D(t.dwSampleLength,this.uInt32),D(t.dwPurposeID,this.uInt32),D(t.dwCountry,this.uInt16),D(t.dwLanguage,this.uInt16),D(t.dwDialect,this.uInt16),D(t.dwCodePage,this.uInt16),R(t.value,t.value.length))}get_PMXBytes_(){let t=[];if(this._PMX.chunkId){let e=x(this._PMX.value);this._PMX.chunkSize=e.length,t=t.concat(x(this._PMX.chunkId),D(this._PMX.chunkSize,this.uInt32),e)}return this.enforceByteLen_(t),t}getJunkBytes_(){let t=[];return this.junk.chunkId?t.concat(x(this.junk.chunkId),D(this.junk.chunkData.length,this.uInt32),this.junk.chunkData):(this.enforceByteLen_(t),t)}enforceByteLen_(t){t.length%2&&t.push(0)}}function X(t,e,s){return!(s<1||t*(e/8)*s>4294967295)}class E extends O{constructor(){super(),this.bitDepth="0",this.dataType={bits:0,be:!1},this.WAV_AUDIO_FORMATS={4:17,8:1,"8a":6,"8m":7,16:1,24:1,32:1,"32f":3,64:3}}fromScratch(t,e,s,i,h){h=h||{},this.clearHeaders(),this.newWavFile_(t,e,s,i,h)}fromBuffer(t,e=!0){super.fromBuffer(t,e),this.bitDepthFromFmt_(),this.updateDataType_()}toBuffer(){return this.validateWavHeader_(),super.toBuffer()}getSamples(t=!1,e=Float64Array){let s=new e(this.data.samples.length/(this.dataType.bits/8));return z(this.data.samples,this.dataType,s,0,this.data.samples.length),!t&&this.fmt.numChannels>1?function(t,e,s=Float64Array){let i=[];for(let h=0;h<e;h++)i[h]=new s(t.length/e);for(let s=0;s<e;s++)for(let h=s,n=0;h<t.length;h+=e,n++)i[s][n]=t[h];return i}(s,this.fmt.numChannels,e):s}getSample(t){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");return B(this.data.samples.slice(t,t+this.dataType.bits/8),this.dataType)}setSample(t,e){if((t*=this.dataType.bits/8)+this.dataType.bits/8>this.data.samples.length)throw new Error("Range error");F(e,this.dataType,this.data.samples,t)}getiXML(){return this.iXML.value}setiXML(t){if("string"!=typeof t)throw new TypeError("iXML value must be a string.");this.iXML.value=t,this.iXML.chunkId="iXML"}get_PMX(){return this._PMX.value}set_PMX(t){if("string"!=typeof t)throw new TypeError("_PMX value must be a string.");this._PMX.value=t,this._PMX.chunkId="_PMX"}newWavFile_(t,e,s,i,h){h.container||(h.container="RIFF"),this.container=h.container,this.bitDepth=s,i=function(t){let e=[];if(t.length>0)if(t[0].constructor!==Number){e=new Float64Array(t[0].length*t.length);for(let s=0,i=t[0].length,h=0;s<i;s++)for(let i=0,n=t.length;i<n;i++,h++)e[h]=t[i][s]}else e=t;return e}(i),this.updateDataType_();let n=this.dataType.bits/8;this.data.samples=new Uint8Array(i.length*n),y(i,this.dataType,this.data.samples,0),this.makeWavHeader_(s,t,e,n,this.data.samples.length,h),this.data.chunkId="data",this.data.chunkSize=this.data.samples.length,this.validateWavHeader_()}makeWavHeader_(t,e,s,i,h,n){"4"==t?this.createADPCMHeader_(t,e,s,i,h,n):"8a"==t||"8m"==t?this.createALawMulawHeader_(t,e,s,i,h,n):-1==Object.keys(this.WAV_AUDIO_FORMATS).indexOf(t)||e>2?this.createExtensibleHeader_(t,e,s,i,h,n):this.createPCMHeader_(t,e,s,i,h,n)}createPCMHeader_(t,e,s,i,h,n){this.container=n.container,this.chunkSize=36+h,this.format="WAVE",this.bitDepth=t,this.fmt={chunkId:"fmt ",chunkSize:16,audioFormat:this.WAV_AUDIO_FORMATS[t]||65534,numChannels:e,sampleRate:s,byteRate:e*i*s,blockAlign:e*i,bitsPerSample:parseInt(t,10),cbSize:0,validBitsPerSample:0,dwChannelMask:0,subformat:[]}}createADPCMHeader_(t,e,s,i,h,n){this.createPCMHeader_(t,e,s,i,h,n),this.chunkSize=40+h,this.fmt.chunkSize=20,this.fmt.byteRate=4055,this.fmt.blockAlign=256,this.fmt.bitsPerSample=4,this.fmt.cbSize=2,this.fmt.validBitsPerSample=505,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:2*h}}createExtensibleHeader_(t,e,s,i,h,n){this.createPCMHeader_(t,e,s,i,h,n),this.chunkSize=60+h,this.fmt.chunkSize=40,this.fmt.bitsPerSample=1+(parseInt(t,10)-1|7),this.fmt.cbSize=22,this.fmt.validBitsPerSample=parseInt(t,10),this.fmt.dwChannelMask=function(t){let e=0;1===t?e=4:2===t?e=3:4===t?e=51:6===t?e=63:8===t&&(e=1599);return e}(e),this.fmt.subformat=[1,1048576,2852126848,1905997824]}createALawMulawHeader_(t,e,s,i,h,n){this.createPCMHeader_(t,e,s,i,h,n),this.chunkSize=40+h,this.fmt.chunkSize=20,this.fmt.cbSize=2,this.fmt.validBitsPerSample=8,this.fact={chunkId:"fact",chunkSize:4,dwSampleLength:h}}bitDepthFromFmt_(){3===this.fmt.audioFormat&&32===this.fmt.bitsPerSample?this.bitDepth="32f":6===this.fmt.audioFormat?this.bitDepth="8a":7===this.fmt.audioFormat?this.bitDepth="8m":this.bitDepth=this.fmt.bitsPerSample.toString()}validateBitDepth_(){if(!this.WAV_AUDIO_FORMATS[this.bitDepth]){if(parseInt(this.bitDepth,10)>8&&parseInt(this.bitDepth,10)<54)return!0;throw new Error("Invalid bit depth.")}return!0}updateDataType_(){this.dataType={bits:1+(parseInt(this.bitDepth,10)-1|7),fp:"32f"==this.bitDepth||"64"==this.bitDepth,signed:"8"!=this.bitDepth,be:"RIFX"==this.container},["4","8a","8m"].indexOf(this.bitDepth)>-1&&(this.dataType.bits=8,this.dataType.signed=!1)}validateWavHeader_(){if(this.validateBitDepth_(),t=this.fmt.numChannels,e=this.fmt.bitsPerSample,t<1||t*e/8>65535)throw new Error("Invalid number of channels.");var t,e;if(!X(this.fmt.numChannels,this.fmt.bitsPerSample,this.fmt.sampleRate))throw new Error("Invalid sample rate.")}}class N extends E{getTag(t){let e=this.getTagIndex_(t);return null!==e.TAG?this.LIST[e.LIST].subChunks[e.TAG].value:null}setTag(t,e){t=function(t){if(t.constructor!==String)throw new Error("Invalid tag name.");if(t.length<4)for(let e=0,s=4-t.length;e<s;e++)t+=" ";return t}(t);let s=this.getTagIndex_(t);null!==s.TAG?(this.LIST[s.LIST].subChunks[s.TAG].chunkSize=e.length+1,this.LIST[s.LIST].subChunks[s.TAG].value=e):null!==s.LIST?this.LIST[s.LIST].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}):(this.LIST.push({chunkId:"LIST",chunkSize:8+e.length+1,format:"INFO",subChunks:[]}),this.LIST[this.LIST.length-1].subChunks.push({chunkId:t,chunkSize:e.length+1,value:e}))}deleteTag(t){let e=this.getTagIndex_(t);return null!==e.TAG&&(this.LIST[e.LIST].subChunks.splice(e.TAG,1),!0)}listTags(){let t=this.getLISTIndex("INFO"),e={};if(null!==t)for(let s=0,i=this.LIST[t].subChunks.length;s<i;s++)e[this.LIST[t].subChunks[s].chunkId]=this.LIST[t].subChunks[s].value;return e}getLISTIndex(t){for(let e=0,s=this.LIST.length;e<s;e++)if(this.LIST[e].format==t)return e;return null}getTagIndex_(t){let e={LIST:null,TAG:null};for(let s=0,i=this.LIST.length;s<i;s++)if("INFO"==this.LIST[s].format){e.LIST=s;for(let i=0,h=this.LIST[s].subChunks.length;i<h;i++)if(this.LIST[s].subChunks[i].chunkId==t){e.TAG=i;break}break}return e}}class H extends N{listCuePoints(){let t=this.getCuePoints_();for(let e=0,s=t.length;e<s;e++)t[e].position=t[e].dwSampleOffset/this.fmt.sampleRate*1e3,t[e].dwSampleLength?(t[e].end=t[e].dwSampleLength/this.fmt.sampleRate*1e3,t[e].end+=t[e].position):t[e].end=null,delete t[e].value;return t}setCuePoint(t){this.cue.chunkId="cue ",t.label||(t.label="");let e=this.getCuePoints_();this.clearLISTadtl_(),this.cue.points=[],t.dwSampleOffset=t.position*this.fmt.sampleRate/1e3,t.dwSampleLength=0,t.end&&(t.dwSampleLength=t.end*this.fmt.sampleRate/1e3-t.dwSampleOffset),0===e.length?this.setCuePoint_(t,1):this.setCuePointInOrder_(e,t),this.cue.dwCuePoints=this.cue.points.length}deleteCuePoint(t){this.cue.chunkId="cue ";let e=this.getCuePoints_();this.clearLISTadtl_();let s=this.cue.points.length;this.cue.points=[];for(let i=0;i<s;i++)i+1!==t&&this.setCuePoint_(e[i],i+1);this.cue.dwCuePoints=this.cue.points.length,this.cue.dwCuePoints?this.cue.chunkId="cue ":(this.cue.chunkId="",this.clearLISTadtl_())}updateLabel(t,e){let s=this.getLISTIndex("adtl");if(null!==s)for(let i=0,h=this.LIST[s].subChunks.length;i<h;i++)this.LIST[s].subChunks[i].dwName==t&&(this.LIST[s].subChunks[i].value=e)}getCuePoints_(){let t=[];for(let e=0;e<this.cue.points.length;e++){let s=this.cue.points[e],i=this.getDataForCuePoint_(s.dwName);i.label=i.value?i.value:"",i.dwPosition=s.dwPosition,i.fccChunk=s.fccChunk,i.dwChunkStart=s.dwChunkStart,i.dwBlockStart=s.dwBlockStart,i.dwSampleOffset=s.dwSampleOffset,t.push(i)}return t}getDataForCuePoint_(t){let e=this.getLISTIndex("adtl"),s={};return null!==e&&this.getCueDataFromLIST_(s,e,t),s}getCueDataFromLIST_(t,e,s){for(let i=0,h=this.LIST[e].subChunks.length;i<h;i++)if(this.LIST[e].subChunks[i].dwName==s){let s=this.LIST[e].subChunks[i];t.value=s.value||t.value,t.dwName=s.dwName||0,t.dwSampleLength=s.dwSampleLength||0,t.dwPurposeID=s.dwPurposeID||0,t.dwCountry=s.dwCountry||0,t.dwLanguage=s.dwLanguage||0,t.dwDialect=s.dwDialect||0,t.dwCodePage=s.dwCodePage||0}}setCuePoint_(t,e){this.cue.points.push({dwName:e,dwPosition:t.dwPosition?t.dwPosition:0,fccChunk:t.fccChunk?t.fccChunk:"data",dwChunkStart:t.dwChunkStart?t.dwChunkStart:0,dwBlockStart:t.dwBlockStart?t.dwBlockStart:0,dwSampleOffset:t.dwSampleOffset}),this.setLabl_(t,e)}setCuePointInOrder_(t,e){let s=!1;for(let i=0;i<t.length;i++)t[i].dwSampleOffset>e.dwSampleOffset&&!s?(this.setCuePoint_(e,i+1),this.setCuePoint_(t[i],i+2),s=!0):this.setCuePoint_(t[i],s?i+2:i+1);s||this.setCuePoint_(e,this.cue.points.length+1)}clearLISTadtl_(){for(let t=0,e=this.LIST.length;t<e;t++)"adtl"==this.LIST[t].format&&this.LIST.splice(t)}setLabl_(t,e){let s=this.getLISTIndex("adtl");null===s&&(this.LIST.push({chunkId:"LIST",chunkSize:4,format:"adtl",subChunks:[]}),s=this.LIST.length-1),this.setLabelText_(s,t,e),t.dwSampleLength&&this.setLtxtChunk_(s,t,e)}setLabelText_(t,e,s){this.LIST[t].subChunks.push({chunkId:"labl",chunkSize:4,dwName:s,value:e.label}),this.LIST[t].chunkSize+=12}setLtxtChunk_(t,e,s){this.LIST[t].subChunks.push({chunkId:"ltxt",chunkSize:20,dwName:s,dwSampleLength:e.dwSampleLength,dwPurposeID:e.dwPurposeID||0,dwCountry:e.dwCountry||0,dwLanguage:e.dwLanguage||0,dwDialect:e.dwDialect||0,dwCodePage:e.dwCodePage||0,value:e.label}),this.LIST[t].chunkSize+=28}}class j{constructor(t,e,s){var i;this.length_=t,this.scaleFactor_=(t-1)/e,this.interpolate=this.sinc,"point"===s.method?this.interpolate=this.point:"linear"===s.method?this.interpolate=this.linear:"cubic"===s.method&&(this.interpolate=this.cubic),this.tangentFactor_=1-Math.max(0,Math.min(1,s.tension||0)),this.sincFilterSize_=s.sincFilterSize||1,this.kernel_=(i=s.sincWindow||W,function(t){return function(t){return 0===t?1:Math.sin(Math.PI*t)/(Math.PI*t)}(t)*i(t)})}point(t,e){return this.getClippedInput_(Math.round(this.scaleFactor_*t),e)}linear(t,e){t=this.scaleFactor_*t;let s=Math.floor(t);return(1-(t-=s))*this.getClippedInput_(s,e)+t*this.getClippedInput_(s+1,e)}cubic(t,e){t=this.scaleFactor_*t;let s=Math.floor(t),i=[this.getTangent_(s,e),this.getTangent_(s+1,e)],h=[this.getClippedInput_(s,e),this.getClippedInput_(s+1,e)],n=(t-=s)*t,a=t*n;return(2*a-3*n+1)*h[0]+(a-2*n+t)*i[0]+(-2*a+3*n)*h[1]+(a-n)*i[1]}sinc(t,e){t=this.scaleFactor_*t;let s=Math.floor(t),i=s-this.sincFilterSize_+1,h=s+this.sincFilterSize_,n=0;for(let s=i;s<=h;s++)n+=this.kernel_(t-s)*this.getClippedInput_(s,e);return n}getTangent_(t,e){return this.tangentFactor_*(this.getClippedInput_(t+1,e)-this.getClippedInput_(t-1,e))/2}getClippedInput_(t,e){return 0<=t&&t<this.length_?e[t]:0}}function W(t){return Math.exp(-t/2*t/2)}const V={point:!1,linear:!1,cubic:!0,sinc:!0},G={IIR:16,FIR:71},Z={IIR:class{constructor(t,e,s){let i=[];for(let h=0;h<t;h++)i.push(this.getCoeffs_({Fs:e,Fc:s,Q:.5/Math.sin(Math.PI/(2*t)*(h+.5))}));this.stages=[];for(let t=0;t<i.length;t++)this.stages[t]={b0:i[t].b[0],b1:i[t].b[1],b2:i[t].b[2],a1:i[t].a[0],a2:i[t].a[1],k:i[t].k,z:[0,0]}}filter(t){let e=t;for(let t=0,s=this.stages.length;t<s;t++)e=this.runStage_(t,e);return e}getCoeffs_(t){let e={a:[],b:[]},s=this.preCalc_(t,e);return e.k=1,e.b.push((1-s.cw)/(2*s.a0)),e.b.push(2*e.b[0]),e.b.push(e.b[0]),e}preCalc_(t,e){let s={},i=2*Math.PI*t.Fc/t.Fs;return s.alpha=Math.sin(i)/(2*t.Q),s.cw=Math.cos(i),s.a0=1+s.alpha,e.a0=s.a0,e.a.push(-2*s.cw/s.a0),e.k=1,e.a.push((1-s.alpha)/s.a0),s}runStage_(t,e){let s=e*this.stages[t].k-this.stages[t].a1*this.stages[t].z[0]-this.stages[t].a2*this.stages[t].z[1],i=this.stages[t].b0*s+this.stages[t].b1*this.stages[t].z[0]+this.stages[t].b2*this.stages[t].z[1];return this.stages[t].z[1]=this.stages[t].z[0],this.stages[t].z[0]=s,i}reset(){for(let t=0;t<this.stages.length;t++)this.stages[t].z=[0,0]}},FIR:class{constructor(t,e,s){let i=2*Math.PI*s/e,h=0;this.filters=[];for(let e=0;e<=t;e++)e-t/2==0?this.filters[e]=i:(this.filters[e]=Math.sin(i*(e-t/2))/(e-t/2),this.filters[e]*=.54-.46*Math.cos(2*Math.PI*e/t)),h+=this.filters[e];for(let e=0;e<=t;e++)this.filters[e]/=h;this.z=this.initZ_()}filter(t){this.z.buf[this.z.pointer]=t;let e=0;for(let t=0,s=this.z.buf.length;t<s;t++)e+=this.filters[t]*this.z.buf[(this.z.pointer+t)%this.z.buf.length];return this.z.pointer=(this.z.pointer+1)%this.z.buf.length,e}reset(){this.z=this.initZ_()}initZ_(){let t=[];for(let e=0;e<this.filters.length-1;e++)t.push(0);return{buf:t,pointer:0}}}};function J(t,e,s,i=null){i=i||{};let h=(s-e)/e+1,n=new Float64Array(t.length*h);i.method=i.method||"cubic";let a=new j(t.length,n.length,{method:i.method,tension:i.tension||0,sincFilterSize:i.sincFilterSize||6,sincWindow:i.sincWindow||void 0,clip:i.clip||"mirror"});if(void 0===i.LPF&&(i.LPF=V[i.method]),i.LPF){i.LPFType=i.LPFType||"IIR";const h=Z[i.LPFType];if(s>e){!function(t,e,s,i){for(let h=0,n=e.length;h<n;h++)e[h]=i.filter(s.interpolate(h,t));i.reset();for(let t=e.length-1;t>=0;t--)e[t]=i.filter(e[t])}(t,n,a,new h(i.LPForder||G[i.LPFType],s,e/2))}else{!function(t,e,s,i){for(let e=0,s=t.length;e<s;e++)t[e]=i.filter(t[e]);i.reset();for(let e=t.length-1;e>=0;e--)t[e]=i.filter(t[e]);Q(t,e,s)}(t,n,a,new h(i.LPForder||G[i.LPFType],e,s/2))}}else Q(t,n,a);return n}function Q(t,e,s){for(let i=0,h=e.length;i<h;i++)e[i]=s.interpolate(i,t)}class q extends H{toRIFF(){let t=new Float64Array(K(this.data.samples.length,this.dataType.bits/8));z(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFF"})}toRIFX(){let t=new Float64Array(K(this.data.samples.length,this.dataType.bits/8));z(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,this.bitDepth,t,{container:"RIFX"})}toIMAADPCM(){if(8e3!==this.fmt.sampleRate)throw new Error("Only 8000 Hz files can be compressed as IMA-ADPCM.");if(1!==this.fmt.numChannels)throw new Error("Only mono files can be compressed as IMA-ADPCM.");{this.assure16Bit_();let t=new Int16Array(K(this.data.samples.length,2));z(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"4",function(t){let e={index:0,predicted:0,step:7},s=new Uint8Array(t.length),i=[],h=0,n=0;for(let a=0,r=t.length;a<r;a++)a%505==0&&0!=a&&(s.set(l(i,e),h),h+=256,i=[],n++),i.push(t[a]);let a=t.length/2;return a%2&&a++,s.slice(0,a+512+4*n)}(t),{container:this.correctContainer_()})}}fromIMAADPCM(t="16"){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t,e=256){let s={index:0,predicted:0,step:7},i=new Int16Array(2*t.length),h=[],n=0;for(let a=0,r=t.length;a<r;a++){if(a%e==0&&0!=a){let t=o(h,s);i.set(t,n),n+=t.length,h=[]}h.push(t[a])}return i}(this.data.samples,this.fmt.blockAlign),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toALaw(){this.assure16Bit_();let t=new Int16Array(K(this.data.samples.length,2));z(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8a",function(t){let e=new Uint8Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=p(t[s]);return e}(t),{container:this.correctContainer_()})}fromALaw(t="16"){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=m(t[s]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toMuLaw(){this.assure16Bit_();let t=new Int16Array(K(this.data.samples.length,2));z(this.data.samples,this.dataType,t,0,this.data.samples.length),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"8m",function(t){let e=new Uint8Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=k(t[s]);return e}(t),{container:this.correctContainer_()})}fromMuLaw(t="16"){this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,"16",function(t){let e=new Int16Array(t.length);for(let s=0,i=t.length;s<i;s++)e[s]=S(t[s]);return e}(this.data.samples),{container:this.correctContainer_()}),"16"!=t&&this.toBitDepth(t)}toBitDepth(t,s=!0){let i=t,h=this.bitDepth;s||("32f"!=t&&(i=this.dataType.bits.toString()),h=""+this.dataType.bits),this.assureUncompressed_();let n=this.getSamples(!0),a=new Float64Array(n.length);e(n,h,a,i),this.fromExisting_(this.fmt.numChannels,this.fmt.sampleRate,t,a,{container:this.correctContainer_()})}toSampleRate(t,e){this.validateResample_(t);let s=this.getSamples(),i=[];if(s.constructor===Float64Array)i=J(s,this.fmt.sampleRate,t,e);else for(let h=0;h<s.length;h++)i.push(J(s[h],this.fmt.sampleRate,t,e));this.fromExisting_(this.fmt.numChannels,t,this.bitDepth,i,{container:this.correctContainer_()})}validateResample_(t){if(!X(this.fmt.numChannels,this.fmt.bitsPerSample,t))throw new Error("Invalid sample rate.");if(["4","8a","8m"].indexOf(this.bitDepth)>-1)throw new Error("wavefile can't change the sample rate of compressed files.")}assure16Bit_(){this.assureUncompressed_(),"16"!=this.bitDepth&&this.toBitDepth("16")}assureUncompressed_(){"8a"==this.bitDepth?this.fromALaw():"8m"==this.bitDepth?this.fromMuLaw():"4"==this.bitDepth&&this.fromIMAADPCM()}correctContainer_(){return"RF64"==this.container?"RIFF":this.container}fromExisting_(t,e,s,i,h){let n=new H;Object.assign(this.fmt,n.fmt),Object.assign(this.fact,n.fact),Object.assign(this.ds64,n.ds64),Object.assign(this.data,n.data),this.newWavFile_(t,e,s,i,h)}}function K(t,e){let s=t/e;return s%2&&s++,s}class Y extends q{constructor(t){super(),t&&this.fromBuffer(t)}fromBase64(e){this.fromBuffer(function(e){let s=new Uint8Array(256);for(let e=0;e<t.length;e++)s[t.charCodeAt(e)]=e;let i=.75*e.length;"="===e[e.length-1]&&(i--,"="===e[e.length-2]&&i--);let h=new Uint8Array(i);for(let t=0,i=0;t<e.length;t+=4){let n=s[e.charCodeAt(t)],a=s[e.charCodeAt(t+1)],r=s[e.charCodeAt(t+2)],u=s[e.charCodeAt(t+3)];h[i++]=n<<2|a>>4,h[i++]=(15&a)<<4|r>>2,h[i++]=(3&r)<<6|63&u}return h}(e))}toBase64(){return function(e){let s="";for(let i=0;i<e.length;i+=3)s+=t[e[i]>>2],s+=t[(3&e[i])<<4|e[i+1]>>4],s+=t[(15&e[i+1])<<2|e[i+2]>>6],s+=t[63&e[i+2]];return e.length%3==2?s=s.substring(0,s.length-1)+"=":e.length%3==1&&(s=s.substring(0,s.length-2)+"=="),s}(this.toBuffer())}toDataURI(){return"data:audio/wav;base64,"+this.toBase64()}fromDataURI(t){this.fromBase64(t.replace("data:audio/wav;base64,",""))}}export{Y as WaveFile};
